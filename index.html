<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Układ sali - symulacja miejsc</title>
<style>
  body { font-family: 'Segoe UI', sans-serif; background: #f9f9fb; color: #333; text-align: center; margin: 0; padding: 20px; }
  h2 { margin-bottom: 5px; font-weight: 500; }
  /* Nagłówek: selektor sali w nagłówku; w druku zostaje czysty tekst */
  #hallTitle { display: none; }
  #hallHeaderSelect {
    font: inherit;
    font-weight: 500;
    color: inherit;
    border: none;
    background: transparent;
    outline: none;
    padding: 0;
    margin: 0;
    text-align: center;
    text-align-last: center;
    -moz-text-align-last: center;
  }
  #hallHeaderSelect option { text-align: center; }

  #printEventName { display: none; margin-bottom: 10px; font-weight: bold; }
  .legend { margin-bottom: 10px; }
  .legend span { display: inline-block; width: 20px; height: 20px; margin-right: 5px; vertical-align: middle; border-radius: 4px; }
  .counter { margin-bottom: 20px; font-weight: bold; }
  .buttons { margin-bottom: 20px; display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; }
  .buttons button { padding: 6px 12px; cursor: pointer; border-radius: 6px; border: 1px solid #ddd; background: #fff; box-shadow: 0 1px 2px rgba(0,0,0,0.06); }
  .buttons button:hover { background: #f2f2f5; }
  .buttons button:disabled { opacity: 0.55; cursor: not-allowed; }
  select, input[type="text"] { padding: 6px 8px; margin-right: 5px; border-radius: 6px; border: 1px solid #ddd; }
  .hall { display: flex; flex-direction: column; align-items: center; gap: 8px; margin-top: 20px; }
  .row { display: flex; justify-content: center; align-items: center; gap: 8px; }
  .row-label { width: 40px; text-align: center; font-weight: bold; }
  .row-sections { display: flex; align-items: center; gap: 60px; }
  .section { display: flex; gap: 4px; }
  /* Ukryj puste skrzydła, żeby gap nie robił sztucznego odstępu */
  .section:empty { display: none; }
  .seat { width: 30px; height: 30px; background: #4CAF50; border-radius: 8px; color: #fff;
    font-size: 13px; display: flex; align-items: center; justify-content: center;
    cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.15); transition: all 0.2s ease; position: relative;
  }
  .seat:hover { transform: translateY(-2px); }
  .seat.reserved { background: #FFCA28; color: #333; }
  .seat.occupied { background: #E53935; }
  .stage { margin: 40px auto 30px; width: 60%; height: 10px; background: #ccc; border-radius: 4px; position: relative; }
  .stage::after { content: 'SCENA'; position: absolute; top: -25px; left: 50%; transform: translateX(-50%); font-size: 17px; color: #666; }
  .balcony-divider { width: 80%; height: 1px; background: #aaa; margin: 30px 0 10px 0; }
  .balcony-title { font-weight: bold; margin-bottom: 10px; }
  @media print {
    body { background: #fff; margin: 0; padding: 10px; }
    .seat { box-shadow: none; }
    .buttons, select, input[type="text"] { display: none; }
    #printEventName { display: block; font-size: 18px; }
    /* W druku pokaż tekstową nazwę sali, selektor ukryj */
    #hallTitle { display: inline; }
    #hallHeaderSelect { display: none; }
  }
</style>
</head>
<body>

<h2 id="hallHeader">
  <span id="hallTitle">Sala symfoniczna AMFN</span>
  <select id="hallHeaderSelect"></select>
</h2>
<div id="printEventName"></div>

<div class="legend">
  <span style="background:#4CAF50;"></span> Wolne
  <span style="background:#FFCA28;"></span> Zarezerwowane
  <span style="background:#E53935;"></span> Zajęte
</div>

<div class="counter" id="seatCounter">
  Wolne: 0 | Zarezerwowane: 0 | Zajęte: 0
</div>

<div class="buttons">
  <!-- w belce zostaje tylko wybór wydarzenia -->
  <select id="eventSelect"></select>
  <button id="addEventBtn" onclick="addEventPrompt()">Dodaj wydarzenie</button>
  <button id="deleteBtn" onclick="deleteEvent()">Usuń wydarzenie</button>
  <button id="editBtn" onclick="editEventName()">Edytuj nazwę</button>
  <button id="reserveAllBtn" onclick="reserveAll()">Wszystko zarezerwowane</button>
  <button id="occupyAllBtn" onclick="occupyAll()">Wszystko zajęte</button>
  <button id="resetBtn" onclick="resetSeats()">Reset</button>
  <button id="printBtn" onclick="window.print()">Drukuj</button>
</div>

<div class="stage"></div>
<div class="hall" id="hall"></div>

<script>
// --- definicja sal ---
const halls = {
  "Sala symfoniczna AMFN": {
    rows: {
      "I": { left:[1,2,3,4,5], center:[6,7,8,9,10,11,12,11,10,9,8,7,6], right:[5,4,3,2,1] },
      "II": { left:[1,2,3,4,5,6,7,8], center:[9,10,11,12,13,14,15,15,14,13,12,11,10,9], right:[8,7,6,5,4,3,2,1] },
      "III": { left:[1,2,3,4,5,6,7,8], center:[9,10,11,12,13,14,15,15,14,13,12,11,10,9], right:[8,7,6,5,4,3,2,1] },
      "IV": { left:[1,2,3,4,5,6,7], center:[8,9,10,11,12,13,14,15,14,13,12,11,10,9,8], right:[7,6,5,4,3,2,1] },
      "V": { left:[1,2,3,4,5,6,7], center:[8,9,10,11,12,13,14,15,14,13,12,11,10,9,8], right:[7,6,5,4,3,2,1] },
      "VI": { left:[1,2,3,4,5,6], center:[7,8,9,10,11,12,13,14,14,13,12,11,10,9,8,7], right:[6,5,4,3,2,1] },
      "VII": { left:[1,2,3,4,5,6], center:[7,8,9,10,11,12,13,14,14,13,12,11,10,9,8,7], right:[6,5,4,3,2,1] },
      "VIII": { left:[1,2,3,4,5], center:[6,7,8,9,10,11,12,13,14,13,12,11,10,9,8,7,6], right:[5,4,3,2,1] },
      "IX": { left:[1,2,3,4,5], center:[6,7,8,9,10,11,12,13,14,13,12,11,10,9,8,7,6], right:[5,4,3,2,1] },
      "X": { left:[1,2,3,4], center:[5,6,7,8,9,10,11,12,13,13,12,11,10,9,8,7,6,5], right:[4,3,2,1] },
      "XI": { left:[1,2,3,4], center:[5,6,7,8,9,10,11,12,13,13,12,11,10,9,8,7,6,5], right:[4,3,2,1] },
      "XII": { left:[1,2,3], center:[4,5,6,7,8,9,10,11,12,13,12,11,10,9,8,7,6,5,4], right:[3,2,1] },
      "XIII": { left:[1,2,3], center:[4,5,6,7,8,9,10,11,12,13,12,11,10,9,8,7,6,5,4], right:[3,2,1] },
      "XIV": { left:[1,2,3], center:[4,5,6,7,8,9,10,11,12,13,13,12,11,10,9,8,7,6,5,4], right:[3,2,1] },
      "XV": { left:[], center:[1,2,3,4,5,6,7,8,9,10,10,9,8,7,6,5,4,3,2,1], right:[] }
    },
    balcony: { left:[1,2,3,4,5,6], center:[7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22], right:[] }
  },
  "Sala teatralno-operowa AMFN": {
    rows: {
      "I": { left:[], center:[1,2,3,4,5,6,7,8,9,10,10,9,8,7,6,5,4,3,2,1], right:[] },
      "II": { left:[], center:[1,2,3,4,5,6,7,8,9,10,10,9,8,7,6,5,4,3,2,1], right:[] },
      "III": { left:[], center:[1,2,3,4,5,6,7,8,9,10,10,9,8,7,6,5,4,3,2,1], right:[] },
      "IV": { left:[], center:[1,2,3,4,5,6,7,8,9,10,10,9,8,7,6,5,4,3,2,1], right:[] },
      "V": { left:[], center:[1,2,3,4,5,6,7,8,9,10,10,9,8,7,6,5,4,3,2,1], right:[] },
      "VI": { left:[], center:[1,2,3,4,5,6,7,8,9,10,10,9,8,7,6,5,4,3,2,1], right:[] },
      "VII": { left:[], center:[1,2,3,4,5,6,7,8,9,10,10,9,8,7,6,5,4,3,2,1], right:[] },
      "VIII": { left:[], center:[1,2,3,4,5,6,7,8,9,10,10,9,8,7,6,5,4,3,2,1], right:[] },
      "IX": { left:[], center:[1,2,3,4,5,6,7,8,7,6,5,4,3,2,1], right:[] }
    },
    balcony: { left:[], center:[1,2,3,4,5,6,7,8,9,10,11,10,9,8,7,6,5,4,3,2,1], right:[] }
  },
  "Sala kameralna AMFN": {
    rows: {
      "I": { left:[], center:[1,2,3,4,5,6,7,8,9,10,10,9,8,7,6,5,4,3,2,1], right:[] },
      "II": { left:[], center:[1,2,3,4,5,6,7,8,9,10,11,10,9,8,7,6,5,4,3,2,1], right:[] },
      "III": { left:[], center:[1,2,3,4,5,6,7,8,9,10,11,11,10,9,8,7,6,5,4,3,2,1], right:[] },
      "IV": { left:[], center:[1,2,3,4,5,6,7,8,9,10,11,11,10,9,8,7,6,5,4,3,2,1], right:[] },
      "V": { left:[], center:[1,2,3,4,5,6,7,8,9,10,11,10,9,8,7,6,5,4,3,2,1], right:[] },
      "VI": { left:[], center:[1,2,3,4,5,6,7,8,9,10,8,7,6,5,4,3,2,1], right:[] }
    },
    balcony: { left:[], center:[16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1], right:[] }
  },
  "Sala organowa AMFN": {
    rows: {
      "I": { left:[], center:[1,2,3,4,5,6,7,8,9,10,11,12,13,14], right:[] },
      "II": { left:[], center:[1,2,3,4,5,6,7,8,9,10,11,12,13,14], right:[] },
      "III": { left:[], center:[1,2,3,4,5,6,7,8,9,10,11,12,13,14], right:[] },
      "IV": { left:[], center:[1,2,3,4,5,6,7,8,9,10,11,12,13,14], right:[] },
      "V": { left:[], center:[1,2,3,4,5,6,7,8,9,10,11,12,13,14], right:[] },
    },
    balcony: { left:[], center:[], right:[] }
  }
};

// --- elementy DOM ---
const hallEl = document.getElementById('hall');
const seatCounter = document.getElementById('seatCounter');
const hallSelect = document.getElementById('hallHeaderSelect'); // selektor sali w nagłówku
const eventSelect = document.getElementById('eventSelect');
const printEventName = document.getElementById('printEventName');
const hallTitle = document.getElementById('hallTitle');
const deleteBtn = document.getElementById('deleteBtn');
const editBtn = document.getElementById('editBtn');
const reserveAllBtn = document.getElementById('reserveAllBtn');
const occupyAllBtn = document.getElementById('occupyAllBtn');
const resetBtn = document.getElementById('resetBtn');

// --- stan ---
let currentHall = Object.keys(halls)[0];
const persistedHall = localStorage.getItem('currentHall');
if (persistedHall && halls[persistedHall]) currentHall = persistedHall;
let currentEvent = null;

// --- helper: bieżące wydarzenie per sala ---
function getCurrentEventForHall(hall){ return localStorage.getItem(`currentEvent:${hall}`) || null; }
function setCurrentEventForHall(hall, ev){
  if(ev && ev.trim()) localStorage.setItem(`currentEvent:${hall}`, ev);
  else localStorage.removeItem(`currentEvent:${hall}`);
}
currentEvent = getCurrentEventForHall(currentHall);

// --- eventy: lista per sala ---
const EVENTS_KEY_PREFIX = 'eventsListV1:';
function eventsKeyForHall(hall){ return `${EVENTS_KEY_PREFIX}${hall}`; }
function getEvents(hall){
  try { return JSON.parse(localStorage.getItem(eventsKeyForHall(hall))) || []; }
  catch { return []; }
}
function saveEvents(hall, list){
  localStorage.setItem(eventsKeyForHall(hall), JSON.stringify([...new Set(list)]));
}
function hydrateEventsFromKeysIfEmpty(hall){
  const events = getEvents(hall);
  if(events.length) return;
  const found = new Set();
  for(let i=0;i<localStorage.length;i++){
    const key = localStorage.key(i);
    if(key && key.startsWith('event-')){
      const after = key.slice(6); // po 'event-'
      const marker = `-${hall}-`;
      const idx = after.indexOf(marker);
      if(idx !== -1){
        const ev = after.slice(0, idx);
        if(ev) found.add(ev);
      }
    }
  }
  if(found.size) saveEvents(hall, [...found]);
}

// --- stała: nazwa domyślnego wydarzenia ---
const DEFAULT_EVENT_NAME = 'Wydarzenie domyślne';

// --- helpers UI ---
function updateUIState(){
  const hasEvent = !!(currentEvent && currentEvent.trim());
  const isDefault = currentEvent === DEFAULT_EVENT_NAME;

  [reserveAllBtn, occupyAllBtn, resetBtn].forEach(btn=>{
    if(btn) btn.disabled = !hasEvent;
  });

  if(deleteBtn) deleteBtn.disabled = !hasEvent || isDefault;
  if(editBtn) editBtn.disabled   = !hasEvent || isDefault;

  printEventName.textContent = currentEvent || '';
}
function updateCounter(){
  let free=0,reserved=0,occupied=0;
  document.querySelectorAll('.seat').forEach(seat=>{
    if(seat.classList.contains('reserved')) reserved++;
    else if(seat.classList.contains('occupied')) occupied++;
    else free++;
  });
  seatCounter.textContent = `Wolne: ${free} | Zarezerwowane: ${reserved} | Zajęte: ${occupied}`;
}

// --- storage miejsc ---
function getSeatStatus(event,row,section,index){
  if(!event) return 'free';
  const key=`event-${event}-${currentHall}-${row}-${section}-${index}`;
  return localStorage.getItem(key)||'free';
}
function setSeatStatus(event,row,section,index,status){
  if(!event) return;
  const key=`event-${event}-${currentHall}-${row}-${section}-${index}`;
  if(status==='free') localStorage.removeItem(key);
  else localStorage.setItem(key,status);
}

// --- dopasowanie szerokości SCENY do najszerszego rzędu ---
function adjustStageWidth(){
  const stage = document.querySelector('.stage');
  if(!stage) return;

  let maxWidth = 0;
  // Bierzemy tylko rzędy z etykietami (pomijamy balkon)
  hallEl.querySelectorAll('.row').forEach(row=>{
    if(!row.querySelector('.row-label')) return; // to jest rząd balkonowy (bez etykiet)
    const rs = row.querySelector('.row-sections');
    if(rs){
      const w = rs.getBoundingClientRect().width;
      if(w > maxWidth) maxWidth = w;
    }
  });

  if(maxWidth > 0){
    stage.style.width = Math.round(maxWidth) + 'px';
  } else {
    stage.style.width = ''; // fallback do CSS (60%)
  }
}

// --- generowanie sali ---
function generateHall(){
  hallEl.innerHTML='';
  hallTitle.textContent = currentHall;
  const hallData = halls[currentHall];
  if(!hallData) return;

  const rows = hallData.rows;
  for(const [rowLabel, sections] of Object.entries(rows)){
    const row=document.createElement('div'); row.className='row';
    const labelLeft=document.createElement('div'); labelLeft.className='row-label'; labelLeft.textContent=rowLabel;
    row.appendChild(labelLeft);

    const rowSections=document.createElement('div'); rowSections.className='row-sections';
    for(let sectionName of ['left','center','right']){
      const sec=sections[sectionName];
      const sectionDiv=document.createElement('div'); sectionDiv.className='section';
      if(sec) sec.forEach((num,index)=>{
        const seat=document.createElement('div'); seat.className='seat'; seat.textContent=num;
        seat.dataset.row = rowLabel;
        seat.dataset.section = sectionName;
        seat.dataset.index = index;
        seat.title = `Rząd ${rowLabel} • ${sectionName} • miejsce ${num}`;

        const status=getSeatStatus(currentEvent,rowLabel,sectionName,index);
        if(status!=='free') seat.classList.add(status);

        seat.addEventListener('click',()=>{
          if(!currentEvent){ alert('Najpierw wybierz lub dodaj wydarzenie.'); return; }
          let currentStatus='free';
          if(seat.classList.contains('reserved')) currentStatus='reserved';
          if(seat.classList.contains('occupied')) currentStatus='occupied';
          seat.classList.remove('reserved','occupied');
          let newStatus='free';
          if(currentStatus==='free') newStatus='reserved';
          else if(currentStatus==='reserved') newStatus='occupied';
          if(newStatus!=='free') seat.classList.add(newStatus);
          setSeatStatus(currentEvent,rowLabel,sectionName,index,newStatus);
          updateCounter();
        });

        sectionDiv.appendChild(seat);
      });
      rowSections.appendChild(sectionDiv);
    }
    row.appendChild(rowSections);
    const labelRight=document.createElement('div'); labelRight.className='row-label'; labelRight.textContent=rowLabel;
    row.appendChild(labelRight);
    hallEl.appendChild(row);
  }

  // balkon (pokazuj tylko, jeśli są miejsca)
  const balcony = hallData.balcony || {};
  const hasBalconySeats = ['left','center','right'].some(s => Array.isArray(balcony[s]) && balcony[s].length > 0);
  if (hasBalconySeats) {
    const divider=document.createElement('div'); divider.className='balcony-divider';
    hallEl.appendChild(divider);
    const title=document.createElement('div'); title.className='balcony-title'; title.textContent='BALKON';
    hallEl.appendChild(title);
    const balconyRow=document.createElement('div'); balconyRow.className='row';
    const balconySections=document.createElement('div'); balconySections.className='row-sections';
    for(let sectionName of ['left','center','right']){
      const sec=balcony[sectionName];
      const sectionDiv=document.createElement('div'); sectionDiv.className='section';
      if(sec) sec.forEach((num,index)=>{
        const seat=document.createElement('div'); seat.className='seat'; seat.textContent=num;
        seat.dataset.row = 'balcony';
        seat.dataset.section = sectionName;
        seat.dataset.index = index;
        seat.title = `Balkon • ${sectionName} • miejsce ${num}`;

        const status=getSeatStatus(currentEvent,'balcony',sectionName,index);
        if(status!=='free') seat.classList.add(status);

        seat.addEventListener('click',()=>{
          if(!currentEvent){ alert('Najpierw wybierz lub dodaj wydarzenie.'); return; }
          let currentStatus='free';
          if(seat.classList.contains('reserved')) currentStatus='reserved';
          if(seat.classList.contains('occupied')) currentStatus='occupied';
          seat.classList.remove('reserved','occupied');
          let newStatus='free';
          if(currentStatus==='free') newStatus='reserved';
          else if(currentStatus==='reserved') newStatus='occupied';
          if(newStatus!=='free') seat.classList.add(newStatus);
          setSeatStatus(currentEvent,'balcony',sectionName,index,newStatus);
          updateCounter();
        });

        sectionDiv.appendChild(seat);
      });
      balconySections.appendChild(sectionDiv);
    }
    balconyRow.appendChild(balconySections);
    hallEl.appendChild(balconyRow);
  }

  updateCounter();
  updateUIState();
  adjustStageWidth(); // dopasuj szerokość sceny po wygenerowaniu układu
}

// --- wybór sali (w nagłówku) ---
function populateHallSelect(){
  hallSelect.innerHTML='';
  Object.keys(halls).forEach(hall=>{
    const opt=document.createElement('option'); opt.value=hall; opt.textContent=hall;
    hallSelect.appendChild(opt);
  });
  hallSelect.value=currentHall;
}
hallSelect.addEventListener('change',()=>{
  currentHall=hallSelect.value;
  localStorage.setItem('currentHall', currentHall);
  updateEventSelect();
  generateHall();
});

// --- wydarzenia (per sala) ---
function ensureDefaultEvent(hall){
  let events = getEvents(hall);
  if(!events.length){
    events = [DEFAULT_EVENT_NAME];
    saveEvents(hall, events);
    setCurrentEventForHall(hall, DEFAULT_EVENT_NAME);
  }
}
function updateEventSelect(){
  hydrateEventsFromKeysIfEmpty(currentHall);
  ensureDefaultEvent(currentHall);
  const events = getEvents(currentHall);
  eventSelect.innerHTML='';
  events.forEach(ev=>{
    const opt=document.createElement('option'); opt.value=ev; opt.textContent=ev;
    eventSelect.appendChild(opt);
  });
  const persistedCurrent = getCurrentEventForHall(currentHall);
  if(currentEvent && events.includes(currentEvent)) {
    eventSelect.value = currentEvent;
    setCurrentEventForHall(currentHall, currentEvent);
  } else if(persistedCurrent && events.includes(persistedCurrent)) {
    currentEvent = persistedCurrent;
    eventSelect.value = currentEvent;
  } else if(events.length){
    currentEvent = events[0];
    eventSelect.value = currentEvent;
    setCurrentEventForHall(currentHall, currentEvent);
  } else {
    currentEvent = null;
    eventSelect.value = '';
    setCurrentEventForHall(currentHall, null);
  }
  updateUIState();
}
function addEventPrompt(){
  const name = prompt('Podaj nazwę wydarzenia:');
  if(name){
    const trimmed = name.trim();
    if(!trimmed) return;
    const events = getEvents(currentHall);
    if(!events.includes(trimmed)){ events.push(trimmed); saveEvents(currentHall, events); }
    currentEvent = trimmed;
    setCurrentEventForHall(currentHall, currentEvent);
    updateEventSelect();
    generateHall();
  }
}
function deleteEvent(){
  if(!currentEvent) return alert('Brak wybranego wydarzenia.');
  if(confirm(`Czy na pewno usunąć wydarzenie "${currentEvent}"?`)){
    const prefixForHall = `event-${currentEvent}-${currentHall}-`;
    const toDelete = [];
    for(let i=0;i<localStorage.length;i++){
      const key = localStorage.key(i);
      if(key && key.startsWith(prefixForHall)){
        toDelete.push(key);
      }
    }
    toDelete.forEach(k=>localStorage.removeItem(k));
    const events = getEvents(currentHall).filter(e=>e!==currentEvent);
    saveEvents(currentHall, events);
    currentEvent = events[0] || null;
    setCurrentEventForHall(currentHall, currentEvent);
    updateEventSelect();
    generateHall();
  }
}
function editEventName(){
  if(!currentEvent) return alert('Brak wybranego wydarzenia.');
  const newName = prompt('Nowa nazwa wydarzenia:', currentEvent);
  if(newName && newName!==currentEvent){
    const trimmed = newName.trim();
    if(!trimmed) return;
    const toRename = [];
    const oldPrefix = `event-${currentEvent}-${currentHall}-`;
    for(let i=0;i<localStorage.length;i++){
      const key = localStorage.key(i);
      if(key && key.startsWith(oldPrefix)){
        toRename.push(key);
      }
    }
    toRename.forEach(key=>{
      const value = localStorage.getItem(key);
      const newKey = key.replace(oldPrefix, `event-${trimmed}-${currentHall}-`);
      localStorage.setItem(newKey, value);
      localStorage.removeItem(key);
    });
    const events = getEvents(currentHall);
    const idx = events.indexOf(currentEvent);
    if(idx !== -1) events[idx] = trimmed;
    else events.push(trimmed);
    saveEvents(currentHall, events);
    currentEvent = trimmed;
    setCurrentEventForHall(currentHall, currentEvent);
    updateEventSelect();
    generateHall();
  }
}
eventSelect.addEventListener('change',()=>{
  currentEvent = eventSelect.value || null;
  setCurrentEventForHall(currentHall, currentEvent);
  generateHall();
  updateUIState();
});

// --- przyciski globalne ---
function reserveAll(){
  if(!currentEvent){ alert('Najpierw wybierz lub dodaj wydarzenie.'); return; }
  document.querySelectorAll('.seat').forEach(seat=>{
    seat.classList.remove('occupied'); seat.classList.add('reserved');
  });
  saveAllSeats('reserved');
  updateCounter();
}
function occupyAll(){
  if(!currentEvent){ alert('Najpierw wybierz lub dodaj wydarzenie.'); return; }
  document.querySelectorAll('.seat').forEach(seat=>{
    seat.classList.remove('reserved'); seat.classList.add('occupied');
  });
  saveAllSeats('occupied');
  updateCounter();
}
function resetSeats(){
  if(!currentEvent){ alert('Najpierw wybierz lub dodaj wydarzenie.'); return; }
  document.querySelectorAll('.seat').forEach(seat=>{
    seat.classList.remove('reserved','occupied');
  });
  saveAllSeats('free');
  updateCounter();
}
function saveAllSeats(status){
  if(!currentEvent) return;
  document.querySelectorAll('.seat').forEach(seat=>{
    const {row, section, index} = seat.dataset;
    setSeatStatus(currentEvent, row, section, Number(index), status);
  });
}

// aktualizuj szerokość “sceny” przy zmianie rozmiaru okna
window.addEventListener('resize', adjustStageWidth);

// --- start ---
populateHallSelect();
updateEventSelect();
generateHall();
updateUIState();
</script>

</body>
</html>
